# CL_Scan 打包方案說明

## 📦 兩種打包方式比較

### 方案一：完整版（Portable Edition）- 推薦
**打包模式：`onedir`**

#### ✅ 優點
- ✓ **無需安裝任何軟體**：內建 Tesseract-OCR 引擎
- ✓ **真正可攜**：複製整個資料夾到任何 Windows 電腦即可使用
- ✓ **多語言支援**：打包繁中、日文、韓文、英文語言包
- ✓ **用戶體驗好**：下載解壓即用，零學習成本
- ✓ **啟動快速**：檔案已解壓，直接執行

#### ❌ 缺點
- ✗ **檔案較大**：約 150 MB（含 OCR 引擎 + 多語言包）
- ✗ **檔案多**：資料夾內有數十個檔案
- ✗ **更新語言包困難**：需要重新打包

#### 📊 檔案大小組成
```
CL_Scan/
├── CL_Scan.exe           ~30 MB  (主程式+依賴)
├── tesseract/
│   └── tesseract.exe     ~40 MB  (OCR 引擎)
└── tessdata/
    ├── chi_tra.traineddata  ~25 MB  (繁中)
    ├── jpn.traineddata      ~18 MB  (日文)
    ├── kor.traineddata      ~15 MB  (韓文)
    └── eng.traineddata      ~5 MB   (英文)
─────────────────────────────────
總計：約 150 MB
```

#### 💡 適用情境
- 分享給非技術人員使用
- 需要快速部署到多台電腦
- 不想讓使用者安裝額外軟體
- 製作 USB 隨身碟工具包

---

### 方案二：輕量版（Lite Edition）
**打包模式：`onefile`**

#### ✅ 優點
- ✓ **檔案小**：約 25 MB
- ✓ **單一檔案**：只有一個 .exe
- ✓ **下載快速**：網路傳輸友善
- ✓ **啟動稍快**：單檔執行
- ✓ **語言包彈性**：使用者可自行安裝需要的語言

#### ❌ 缺點
- ✗ **需要安裝 Tesseract**：使用者必須自行安裝（約 80 MB）
- ✗ **安裝門檻**：需要下載、安裝、選擇語言包
- ✗ **路徑依賴**：必須安裝到預設路徑
- ✗ **首次啟動慢**：需解壓暫存檔到 %TEMP%
- ✗ **支援成本高**：使用者可能安裝失敗

#### 📊 實際總大小
```
使用者端：
CL_Scan.exe               ~25 MB  (下載)
+ Tesseract-OCR 安裝檔    ~80 MB  (額外下載)
+ 已安裝 Tesseract        ~100 MB (硬碟佔用)
─────────────────────────────────
總計：實際佔用 ~125 MB + 下載 105 MB
```

#### 💡 適用情境
- 技術用戶
- 已有 Tesseract 環境的電腦
- 網路環境不佳（首次下載小）
- 需要彈性切換 OCR 版本

---

## 🎯 PyInstaller 打包模式完整解析

### 1. `--onefile` 模式
**原理：** 將所有檔案打包成單一 .exe，執行時解壓到 `%TEMP%`

**優點：**
- 單一檔案，分享方便
- 不會留下檔案（關閉後刪除暫存）

**缺點：**
- 啟動慢（每次都要解壓）
- 防毒軟體可能誤判
- 檔案變大（壓縮率低）
- **無法打包外部資源**（如 Tesseract.exe）
- 多次執行會累積暫存檔（系統清理前）

**適用：** 簡單工具、純 Python 程式

---

### 2. `--onedir` 模式
**原理：** 打包成資料夾，所有依賴檔案都在資料夾內

**優點：**
- 啟動快速（無需解壓）
- **可包含外部執行檔**（如 Tesseract）
- **可包含資料檔**（如語言包）
- 可單獨更新部分檔案
- 防毒軟體友善

**缺點：**
- 多檔案資料夾
- 需壓縮成 ZIP 才能分享
- 資料夾可能被誤刪

**適用：** 需要外部資源的複雜程式

---

### 3. `--add-binary` 參數
**用途：** 打包額外的執行檔

```python
'--add-binary=C:/path/to/tesseract.exe;tesseract'
#             ↑ 來源檔案路徑            ↑ 目標資料夾名稱
```

**實際效果：**
```
dist/CL_Scan/
├── CL_Scan.exe
└── tesseract/
    └── tesseract.exe  ← 打包進來
```

**注意：**
- **只能用於 onedir 模式**
- onefile 模式無效（會解壓到 temp，路徑不固定）

---

### 4. `--add-data` 參數
**用途：** 打包資料檔案或資料夾

```python
'--add-data=C:/path/to/tessdata;tessdata'
#           ↑ 來源資料夾          ↑ 目標資料夾名稱
```

**實際效果：**
```
dist/CL_Scan/
├── CL_Scan.exe
└── tessdata/
    ├── chi_tra.traineddata  ← 整個資料夾內容
    ├── eng.traineddata
    └── ...
```

---

### 5. `--windowed` 參數
**效果：** 不顯示命令列視窗（GUI 程式必用）

**差異：**
```
無 --windowed：  [黑色視窗] + [GUI視窗]
有 --windowed：  [GUI視窗]
```

---

### 6. `--hidden-import` 參數
**用途：** 強制包含 PyInstaller 無法自動偵測的模組

**為什麼需要：**
- 動態導入的模組（`importlib.import_module`）
- 反射機制（`__import__`）
- 特殊框架（如 CustomTkinter）

**範例：**
```python
'--hidden-import=PIL._tkinter_finder',  # PIL 的內部模組
'--hidden-import=customtkinter',        # CustomTkinter 主模組
```

---

### 7. 其他實用參數

#### `--icon=icon.ico`
設定執行檔圖示

```python
'--icon=app.ico'  # 需要 .ico 格式
```

#### `--uac-admin`
要求管理員權限（每次執行都會彈 UAC 提示）

```python
'--uac-admin'  # 慎用！
```

#### `--version-file=version.txt`
嵌入版本資訊（右鍵→內容→詳細資料）

```python
'--version-file=version_info.txt'
```

#### `--splash=splash.png`
顯示啟動畫面（僅 onefile 有效，因為需要載入時間）

```python
'--splash=loading.png'  # 640x480 推薦
```

#### `--noconsole` 
等同於 `--windowed`

#### `--clean`
打包前清理暫存檔（推薦）

#### `--noconfirm`
覆蓋舊檔案不詢問（自動化腳本必用）

---

## 🎨 實際打包範例

### 完整版打包命令（onedir + Tesseract）
```python
PyInstaller.__main__.run([
    'ocr_tool.py',
    '--onedir',                                    # 資料夾模式
    '--windowed',                                  # 無命令列
    '--name=CL_Scan',                              # 執行檔名稱
    '--add-binary=C:/Program Files/Tesseract-OCR/tesseract.exe;tesseract',
    '--add-data=C:/Program Files/Tesseract-OCR/tessdata;tessdata',
    '--hidden-import=customtkinter',
    '--clean',
    '--noconfirm',
])
```

### 輕量版打包命令（onefile）
```python
PyInstaller.__main__.run([
    'ocr_tool.py',
    '--onefile',                                   # 單檔模式
    '--windowed',
    '--name=CL_Scan',
    '--hidden-import=customtkinter',
    '--clean',
    '--noconfirm',
])
```

---

## 📈 效能比較

| 項目 | 完整版 (onedir) | 輕量版 (onefile) |
|------|----------------|-----------------|
| **初次下載** | 150 MB | 25 MB + 80 MB (Tesseract) |
| **硬碟佔用** | 150 MB | 125 MB (含 Tesseract) |
| **啟動時間** | ~2 秒 | ~4 秒（首次 5-8 秒） |
| **安裝步驟** | 0 步驟 | 3 步驟 |
| **便攜性** | ★★★★★ | ★★☆☆☆ |
| **維護成本** | 低 | 中（需處理安裝問題） |
| **更新彈性** | 低 | 高 |

---

## 🔧 修改 Tesseract 路徑（程式碼層面）

如果使用者安裝到非預設路徑，需修改 `ocr_tool.py`：

```python
# 目前硬編碼路徑
TESSERACT_CMD = r'C:\Program Files\Tesseract-OCR\tesseract.exe'

# 改為自動偵測（完整版）
if getattr(sys, 'frozen', False):
    # 如果是打包後的 exe
    base_path = sys._MEIPASS  # onedir: dist/CL_Scan/
    TESSERACT_CMD = os.path.join(base_path, 'tesseract', 'tesseract.exe')
else:
    # 開發環境
    TESSERACT_CMD = r'C:\Program Files\Tesseract-OCR\tesseract.exe'
```

---

## 🎯 建議選擇

### 推薦完整版（onedir）如果：
- ✅ 目標用戶是一般使用者
- ✅ 希望零安裝門檻
- ✅ 檔案大小可接受（150 MB）
- ✅ 網路頻寬足夠（或用 USB 傳輸）

### 推薦輕量版（onefile）如果：
- ✅ 目標用戶是技術人員
- ✅ 已有 Tesseract 環境
- ✅ 需要經常網路傳輸
- ✅ 需要彈性安裝語言包

### 🎁 提供兩種版本（最佳方案）
讓使用者根據需求選擇！

---

## 📝 使用說明

### 打包完整版
```bash
python build_exe.py
```

### 打包輕量版
```bash
python build_exe_lite.py
```

### 一鍵打包（批次檔）
```bash
打包.bat
# 選擇 [1] 完整版 / [2] 輕量版 / [3] 兩種都打包
```

---

## ⚠️ 常見問題

### Q: 為什麼完整版還是 150 MB？
**A:** 組成如下：
- Python 運行時 + 依賴庫：~30 MB
- Tesseract 執行檔：~40 MB
- 繁中語言包：~25 MB
- 日文語言包：~18 MB
- 韓文語言包：~15 MB
- 其他檔案：~22 MB

如果只需要繁中，可以刪除日韓語言包，減少到約 100 MB。

### Q: 可以進一步壓縮嗎？
**A:** 可以使用 UPX 壓縮：
```python
'--upx-dir=/path/to/upx',  # 需要額外下載 UPX
```
但可能導致：
- 防毒軟體誤判增加
- 啟動時間變長（需解壓）
- 相容性問題

### Q: 能打包成安裝包（.msi）嗎？
**A:** 可以！使用：
- Inno Setup（免費）
- NSIS（免費）
- WiX Toolset（進階）

### Q: Mac/Linux 支援？
**A:** PyInstaller 支援跨平台，但：
- 需要在各平台分別打包
- Mac 需要程式碼簽名（$99/年）
- Linux 需要處理不同發行版依賴

---

**建議：提供完整版 + 輕量版兩種選擇！**
